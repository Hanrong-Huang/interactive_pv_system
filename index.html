<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive PV System Educational Minigame</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <h1 class="title">Interactive PV System Education</h1>
            <p class="subtitle">Learn PV system design through hands-on interaction</p>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="nav">
        <div class="container">
            <div class="nav-buttons">
                <button class="nav-btn active" data-section="diagram">System Diagram</button>
                <button class="nav-btn" data-section="array-config">Array Configuration</button>
                <button class="nav-btn" data-section="site-analysis">Site Analysis</button>
                <button class="nav-btn" data-section="mppt-selection">MPPT Selection</button>
                <button class="nav-btn" data-section="inverter-selection">AC System</button>
                <button class="nav-btn" data-section="simulation">System Simulation</button>
            </div>
        </div>
    </nav>

    <!-- Main Content Container -->
    <main class="main-content">
        <div class="container">
            
            <!-- Section 1: Interactive PV System Diagram -->
            <section id="diagram-section" class="section active">
                <div class="section-header">
                    <h2>Interactive PV System Diagram</h2>
                    <p>Click on any component to learn about its function and specifications</p>
                </div>
                
                <div class="diagram-container">
                    <svg id="pv-diagram" viewBox="0 0 1200 700" class="pv-diagram">
                        <!-- Solar Panels -->
                        <g id="solar-panels" class="component clickable" data-component="panels">
                            <!-- Main panel frame -->
                            <rect x="80" y="80" width="200" height="120" fill="#1e40af" stroke="#1e3a8a" stroke-width="3" rx="5"/>
                            <!-- Aluminum frame -->
                            <rect x="82" y="82" width="196" height="116" fill="none" stroke="#6b7280" stroke-width="2" rx="3"/>
                            
                            <!-- Solar cells grid (6x4) -->
                            <g class="solar-cells">
                                <!-- Row 1 -->
                                <rect x="90" y="90" width="28" height="22" fill="#2563eb" stroke="#1d4ed8" stroke-width="0.5" rx="2"/>
                                <rect x="124" y="90" width="28" height="22" fill="#2563eb" stroke="#1d4ed8" stroke-width="0.5" rx="2"/>
                                <rect x="158" y="90" width="28" height="22" fill="#2563eb" stroke="#1d4ed8" stroke-width="0.5" rx="2"/>
                                <rect x="192" y="90" width="28" height="22" fill="#2563eb" stroke="#1d4ed8" stroke-width="0.5" rx="2"/>
                                <rect x="226" y="90" width="28" height="22" fill="#2563eb" stroke="#1d4ed8" stroke-width="0.5" rx="2"/>
                                <rect x="260" y="90" width="15" height="22" fill="#2563eb" stroke="#1d4ed8" stroke-width="0.5" rx="2"/>
                                <!-- Row 2 -->
                                <rect x="90" y="118" width="28" height="22" fill="#2563eb" stroke="#1d4ed8" stroke-width="0.5" rx="2"/>
                                <rect x="124" y="118" width="28" height="22" fill="#2563eb" stroke="#1d4ed8" stroke-width="0.5" rx="2"/>
                                <rect x="158" y="118" width="28" height="22" fill="#2563eb" stroke="#1d4ed8" stroke-width="0.5" rx="2"/>
                                <rect x="192" y="118" width="28" height="22" fill="#2563eb" stroke="#1d4ed8" stroke-width="0.5" rx="2"/>
                                <rect x="226" y="118" width="28" height="22" fill="#2563eb" stroke="#1d4ed8" stroke-width="0.5" rx="2"/>
                                <rect x="260" y="118" width="15" height="22" fill="#2563eb" stroke="#1d4ed8" stroke-width="0.5" rx="2"/>
                                <!-- Row 3 -->
                                <rect x="90" y="146" width="28" height="22" fill="#2563eb" stroke="#1d4ed8" stroke-width="0.5" rx="2"/>
                                <rect x="124" y="146" width="28" height="22" fill="#2563eb" stroke="#1d4ed8" stroke-width="0.5" rx="2"/>
                                <rect x="158" y="146" width="28" height="22" fill="#2563eb" stroke="#1d4ed8" stroke-width="0.5" rx="2"/>
                                <rect x="192" y="146" width="28" height="22" fill="#2563eb" stroke="#1d4ed8" stroke-width="0.5" rx="2"/>
                                <rect x="226" y="146" width="28" height="22" fill="#2563eb" stroke="#1d4ed8" stroke-width="0.5" rx="2"/>
                                <rect x="260" y="146" width="15" height="22" fill="#2563eb" stroke="#1d4ed8" stroke-width="0.5" rx="2"/>
                                <!-- Row 4 -->
                                <rect x="90" y="174" width="28" height="22" fill="#2563eb" stroke="#1d4ed8" stroke-width="0.5" rx="2"/>
                                <rect x="124" y="174" width="28" height="22" fill="#2563eb" stroke="#1d4ed8" stroke-width="0.5" rx="2"/>
                                <rect x="158" y="174" width="28" height="22" fill="#2563eb" stroke="#1d4ed8" stroke-width="0.5" rx="2"/>
                                <rect x="192" y="174" width="28" height="22" fill="#2563eb" stroke="#1d4ed8" stroke-width="0.5" rx="2"/>
                                <rect x="226" y="174" width="28" height="22" fill="#2563eb" stroke="#1d4ed8" stroke-width="0.5" rx="2"/>
                                <rect x="260" y="174" width="15" height="22" fill="#2563eb" stroke="#1d4ed8" stroke-width="0.5" rx="2"/>
                            </g>
                            
                            <!-- Junction box -->
                            <rect x="150" y="202" width="60" height="15" fill="#4b5563" stroke="#374151" stroke-width="1" rx="3"/>
                            <rect x="155" y="205" width="50" height="9" fill="#6b7280" rx="2"/>
                            <!-- Wiring -->
                            <line x1="180" y1="217" x2="180" y2="225" stroke="#dc2626" stroke-width="2"/>
                            <line x1="175" y1="217" x2="175" y2="225" stroke="#000" stroke-width="2"/>
                            
                            <text x="180" y="240" text-anchor="middle" class="component-label">Solar Panels</text>
                        </g>

                        <!-- MPPT Charge Controller -->
                        <g id="mppt-controller" class="component clickable" data-component="mppt">
                            <!-- Main controller body -->
                            <rect x="400" y="100" width="100" height="60" fill="#059669" stroke="#047857" stroke-width="3" rx="5"/>
                            <!-- Front panel -->
                            <rect x="405" y="105" width="90" height="50" fill="#065f46" stroke="#047857" stroke-width="1" rx="3"/>
                            <!-- LCD display -->
                            <rect x="415" y="115" width="35" height="15" fill="#000" stroke="#374151" stroke-width="1" rx="2"/>
                            <rect x="417" y="117" width="31" height="11" fill="#22c55e" rx="1"/>
                            <text x="432" y="126" text-anchor="middle" font-size="6" fill="#000">150W</text>
                            <!-- LED indicators -->
                            <circle cx="465" cy="115" r="3" fill="#22c55e" stroke="#16a34a" stroke-width="1"/>
                            <circle cx="465" cy="125" r="3" fill="#fbbf24" stroke="#f59e0b" stroke-width="1"/>
                            <circle cx="465" cy="135" r="3" fill="#ef4444" stroke="#dc2626" stroke-width="1"/>
                            <!-- Heat sink -->
                            <g class="heat-sink">
                                <rect x="405" y="138" width="10" height="20" fill="#6b7280" stroke="#4b5563" stroke-width="1"/>
                                <line x1="407" y1="140" x2="407" y2="156" stroke="#9ca3af" stroke-width="0.5"/>
                                <line x1="409" y1="140" x2="409" y2="156" stroke="#9ca3af" stroke-width="0.5"/>
                                <line x1="411" y1="140" x2="411" y2="156" stroke="#9ca3af" stroke-width="0.5"/>
                                <line x1="413" y1="140" x2="413" y2="156" stroke="#9ca3af" stroke-width="0.5"/>
                            </g>
                            <!-- Terminals -->
                            <rect x="430" y="160" width="8" height="5" fill="#fbbf24" stroke="#f59e0b" stroke-width="1"/>
                            <rect x="442" y="160" width="8" height="5" fill="#fbbf24" stroke="#f59e0b" stroke-width="1"/>
                            <rect x="454" y="160" width="8" height="5" fill="#dc2626" stroke="#b91c1c" stroke-width="1"/>
                            <rect x="466" y="160" width="8" height="5" fill="#dc2626" stroke="#b91c1c" stroke-width="1"/>
                            
                            <text x="450" y="90" text-anchor="middle" class="component-label">MPPT Controller</text>
                        </g>

                        <!-- Battery Bank -->
                        <g id="battery-bank" class="component clickable" data-component="battery">
                            <!-- Battery bank enclosure -->
                            <rect x="400" y="330" width="100" height="80" fill="#374151" stroke="#1f2937" stroke-width="3" rx="5"/>
                            <!-- Individual batteries -->
                            <g class="battery-1">
                                <rect x="410" y="340" width="18" height="25" fill="#dc2626" stroke="#b91c1c" stroke-width="1" rx="2"/>
                                <rect x="412" y="332" width="4" height="8" fill="#6b7280" stroke="#4b5563" stroke-width="1" rx="1"/>
                                <rect x="422" y="332" width="4" height="8" fill="#6b7280" stroke="#4b5563" stroke-width="1" rx="1"/>
                                <text x="419" y="355" text-anchor="middle" font-size="8" fill="white">12V</text>
                            </g>
                            <g class="battery-2">
                                <rect x="432" y="340" width="18" height="25" fill="#dc2626" stroke="#b91c1c" stroke-width="1" rx="2"/>
                                <rect x="434" y="332" width="4" height="8" fill="#6b7280" stroke="#4b5563" stroke-width="1" rx="1"/>
                                <rect x="444" y="332" width="4" height="8" fill="#6b7280" stroke="#4b5563" stroke-width="1" rx="1"/>
                                <text x="441" y="355" text-anchor="middle" font-size="8" fill="white">12V</text>
                            </g>
                            <g class="battery-3">
                                <rect x="454" y="340" width="18" height="25" fill="#dc2626" stroke="#b91c1c" stroke-width="1" rx="2"/>
                                <rect x="456" y="332" width="4" height="8" fill="#6b7280" stroke="#4b5563" stroke-width="1" rx="1"/>
                                <rect x="466" y="332" width="4" height="8" fill="#6b7280" stroke="#4b5563" stroke-width="1" rx="1"/>
                                <text x="463" y="355" text-anchor="middle" font-size="8" fill="white">12V</text>
                            </g>
                            <g class="battery-4">
                                <rect x="476" y="340" width="18" height="25" fill="#dc2626" stroke="#b91c1c" stroke-width="1" rx="2"/>
                                <rect x="478" y="332" width="4" height="8" fill="#6b7280" stroke="#4b5563" stroke-width="1" rx="1"/>
                                <rect x="488" y="332" width="4" height="8" fill="#6b7280" stroke="#4b5563" stroke-width="1" rx="1"/>
                                <text x="485" y="355" text-anchor="middle" font-size="8" fill="white">12V</text>
                            </g>
                            
                            <!-- Lower row batteries -->
                            <g class="battery-5">
                                <rect x="410" y="375" width="18" height="25" fill="#dc2626" stroke="#b91c1c" stroke-width="1" rx="2"/>
                                <rect x="412" y="367" width="4" height="8" fill="#6b7280" stroke="#4b5563" stroke-width="1" rx="1"/>
                                <rect x="422" y="367" width="4" height="8" fill="#6b7280" stroke="#4b5563" stroke-width="1" rx="1"/>
                                <text x="419" y="390" text-anchor="middle" font-size="8" fill="white">12V</text>
                            </g>
                            <g class="battery-6">
                                <rect x="432" y="375" width="18" height="25" fill="#dc2626" stroke="#b91c1c" stroke-width="1" rx="2"/>
                                <rect x="434" y="367" width="4" height="8" fill="#6b7280" stroke="#4b5563" stroke-width="1" rx="1"/>
                                <rect x="444" y="367" width="4" height="8" fill="#6b7280" stroke="#4b5563" stroke-width="1" rx="1"/>
                                <text x="441" y="390" text-anchor="middle" font-size="8" fill="white">12V</text>
                            </g>
                            <g class="battery-7">
                                <rect x="454" y="375" width="18" height="25" fill="#dc2626" stroke="#b91c1c" stroke-width="1" rx="2"/>
                                <rect x="456" y="367" width="4" height="8" fill="#6b7280" stroke="#4b5563" stroke-width="1" rx="1"/>
                                <rect x="466" y="367" width="4" height="8" fill="#6b7280" stroke="#4b5563" stroke-width="1" rx="1"/>
                                <text x="463" y="390" text-anchor="middle" font-size="8" fill="white">12V</text>
                            </g>
                            <g class="battery-8">
                                <rect x="476" y="375" width="18" height="25" fill="#dc2626" stroke="#b91c1c" stroke-width="1" rx="2"/>
                                <rect x="478" y="367" width="4" height="8" fill="#6b7280" stroke="#4b5563" stroke-width="1" rx="1"/>
                                <rect x="488" y="367" width="4" height="8" fill="#6b7280" stroke="#4b5563" stroke-width="1" rx="1"/>
                                <text x="485" y="390" text-anchor="middle" font-size="8" fill="white">12V</text>
                            </g>
                            
                            <!-- Connection wires between batteries -->
                            <line x1="428" y1="352" x2="432" y2="352" stroke="#fbbf24" stroke-width="2"/>
                            <line x1="450" y1="352" x2="454" y2="352" stroke="#fbbf24" stroke-width="2"/>
                            <line x1="472" y1="352" x2="476" y2="352" stroke="#fbbf24" stroke-width="2"/>
                            
                            <line x1="428" y1="387" x2="432" y2="387" stroke="#000" stroke-width="2"/>
                            <line x1="450" y1="387" x2="454" y2="387" stroke="#000" stroke-width="2"/>
                            <line x1="472" y1="387" x2="476" y2="387" stroke="#000" stroke-width="2"/>
                            
                            <text x="450" y="425" text-anchor="middle" class="component-label">Battery Bank (48V)</text>
                        </g>

                        <!-- Inverter -->
                        <g id="inverter" class="component clickable" data-component="inverter">
                            <!-- Main inverter body -->
                            <rect x="660" y="330" width="100" height="80" fill="#7c3aed" stroke="#6d28d9" stroke-width="3" rx="5"/>
                            <!-- Front panel -->
                            <rect x="665" y="335" width="90" height="70" fill="#8b5cf6" stroke="#7c3aed" stroke-width="1" rx="3"/>

                            <!-- Ventilation grilles -->
                            <g class="ventilation">
                                <line x1="670" y1="340" x2="750" y2="340" stroke="#6d28d9" stroke-width="1"/>
                                <line x1="670" y1="345" x2="750" y2="345" stroke="#6d28d9" stroke-width="1"/>
                                <line x1="670" y1="350" x2="750" y2="350" stroke="#6d28d9" stroke-width="1"/>
                                <line x1="670" y1="390" x2="750" y2="390" stroke="#6d28d9" stroke-width="1"/>
                                <line x1="670" y1="395" x2="750" y2="395" stroke="#6d28d9" stroke-width="1"/>
                                <line x1="670" y1="400" x2="750" y2="400" stroke="#6d28d9" stroke-width="1"/>
                            </g>

                            <!-- LCD display -->
                            <rect x="675" y="360" width="25" height="15" fill="#000" stroke="#374151" stroke-width="1" rx="2"/>
                            <rect x="677" y="362" width="21" height="11" fill="#3b82f6" rx="1"/>
                            <text x="687" y="370" text-anchor="middle" font-size="6" fill="white">2.4kW</text>

                            <!-- AC wave symbol -->
                            <g class="ac-symbol">
                                <path d="M 705 365 Q 715 355 725 365 Q 735 375 745 365" fill="none" stroke="#fbbf24" stroke-width="2"/>
                                <path d="M 705 375 Q 715 365 725 375 Q 735 385 745 375" fill="none" stroke="#fbbf24" stroke-width="2"/>
                            </g>

                            <!-- LED indicators -->
                            <circle cx="720" cy="355" r="2" fill="#22c55e" stroke="#16a34a" stroke-width="1"/>
                            <circle cx="730" cy="355" r="2" fill="#3b82f6" stroke="#2563eb" stroke-width="1"/>
                            <circle cx="740" cy="355" r="2" fill="#ef4444" stroke="#dc2626" stroke-width="1"/>

                            <!-- Cooling fan -->
                            <circle cx="710" cy="385" r="8" fill="#4b5563" stroke="#374151" stroke-width="1"/>
                            <line x1="706" y1="381" x2="714" y2="389" stroke="#9ca3af" stroke-width="1"/>
                            <line x1="714" y1="381" x2="706" y2="389" stroke="#9ca3af" stroke-width="1"/>
                            <line x1="710" y1="377" x2="710" y2="393" stroke="#9ca3af" stroke-width="1"/>
                            <line x1="702" y1="385" x2="718" y2="385" stroke="#9ca3af" stroke-width="1"/>

                            <!-- DC/AC conversion symbol -->
                            <text x="680" y="385" font-size="10" fill="#dc2626" font-weight="bold">DC</text>
                            <text x="730" y="395" font-size="10" fill="#fbbf24" font-weight="bold">AC</text>

                            <text x="710" y="430" text-anchor="middle" class="component-label">Inverter</text>
                        </g>

                        <!-- DC Loads -->
                        <g id="dc-loads" class="component clickable" data-component="dc-loads">
                            <!-- LED Strip -->
                            <rect x="680" y="100" width="60" height="8" fill="#fbbf24" stroke="#f59e0b" stroke-width="1" rx="4"/>
                            <circle cx="685" cy="104" r="2" fill="#fff" opacity="0.8"/>
                            <circle cx="695" cy="104" r="2" fill="#fff" opacity="0.8"/>
                            <circle cx="705" cy="104" r="2" fill="#fff" opacity="0.8"/>
                            <circle cx="715" cy="104" r="2" fill="#fff" opacity="0.8"/>
                            <circle cx="725" cy="104" r="2" fill="#fff" opacity="0.8"/>
                            <circle cx="735" cy="104" r="2" fill="#fff" opacity="0.8"/>

                            <!-- DC Fan -->
                            <circle cx="680" cy="125" r="12" fill="#6b7280" stroke="#4b5563" stroke-width="2"/>
                            <circle cx="680" cy="125" r="8" fill="#9ca3af" stroke="#6b7280" stroke-width="1"/>
                            <line x1="675" y1="120" x2="685" y2="130" stroke="#374151" stroke-width="2"/>
                            <line x1="685" y1="120" x2="675" y2="130" stroke="#374151" stroke-width="2"/>
                            <circle cx="680" cy="125" r="2" fill="#374151"/>

                            <!-- DC Refrigerator -->
                            <rect x="720" y="115" width="25" height="35" fill="#e5e7eb" stroke="#d1d5db" stroke-width="2" rx="3"/>
                            <rect x="723" y="118" width="19" height="12" fill="#3b82f6" stroke="#2563eb" stroke-width="1" rx="1"/>
                            <rect x="725" y="132" width="15" height="8" fill="#6b7280" stroke="#4b5563" stroke-width="1" rx="1"/>
                            <circle cx="740" cy="128" r="1" fill="#374151"/>
                            <text x="732" y="146" text-anchor="middle" font-size="6" fill="#4b5563">DC</text>

                            <!-- Electronics (Charge Controller) -->
                            <rect x="695" y="135" width="20" height="12" fill="#374151" stroke="#1f2937" stroke-width="1" rx="2"/>
                            <rect x="697" y="137" width="5" height="3" fill="#22c55e" rx="1"/>
                            <rect x="704" y="137" width="5" height="3" fill="#ef4444" rx="1"/>
                            <rect x="711" y="137" width="2" height="8" fill="#6b7280" rx="1"/>

                            <text x="705" y="170" text-anchor="middle" class="component-label">DC Loads</text>
                        </g>

                        <!-- AC Loads -->
                        <g id="ac-loads" class="component clickable" data-component="ac-loads">
                            <!-- Refrigerator -->
                            <rect x="865" y="330" width="30" height="45" fill="#e5e7eb" stroke="#d1d5db" stroke-width="2" rx="3"/>
                            <rect x="868" y="333" width="24" height="18" fill="#3b82f6" stroke="#2563eb" stroke-width="1" rx="2"/>
                            <rect x="870" y="355" width="20" height="12" fill="#6b7280" stroke="#4b5563" stroke-width="1" rx="1"/>
                            <circle cx="890" cy="348" r="1.5" fill="#374151"/>
                            <text x="880" y="383" text-anchor="middle" font-size="6" fill="#4b5563">AC</text>
                            
                            <!-- TV -->
                            <rect x="905" y="340" width="35" height="25" fill="#1f2937" stroke="#111827" stroke-width="2" rx="2"/>
                            <rect x="908" y="343" width="29" height="19" fill="#3b82f6" stroke="#2563eb" stroke-width="1" rx="1"/>
                            <rect x="920" y="367" width="5" height="3" fill="#6b7280" stroke="#4b5563" stroke-width="1" rx="1"/>
                            <circle cx="922" cy="372" r="1" fill="#ef4444"/>
                            
                            <!-- Water Pump -->
                            <circle cx="885" cy="395" r="15" fill="#2563eb" stroke="#1d4ed8" stroke-width="2"/>
                            <circle cx="885" cy="395" r="10" fill="#3b82f6" stroke="#2563eb" stroke-width="1"/>
                            <circle cx="885" cy="395" r="3" fill="#1f2937"/>
                            <line x1="885" y1="380" x2="885" y2="388" stroke="#6b7280" stroke-width="3"/>
                            <rect x="883" y="378" width="4" height="4" fill="#9ca3af" stroke="#6b7280" stroke-width="1"/>
                            
                            <!-- Lighting -->
                            <g class="ac-lights">
                                <circle cx="915" cy="395" r="8" fill="#fbbf24" stroke="#f59e0b" stroke-width="2"/>
                                <circle cx="915" cy="395" r="5" fill="#fef3c7" opacity="0.8"/>
                                <line x1="907" y1="387" x2="923" y2="403" stroke="#f59e0b" stroke-width="1"/>
                                <line x1="923" y1="387" x2="907" y2="403" stroke="#f59e0b" stroke-width="1"/>
                                <line x1="915" y1="379" x2="915" y2="411" stroke="#f59e0b" stroke-width="1"/>
                                <line x1="899" y1="395" x2="931" y2="395" stroke="#f59e0b" stroke-width="1"/>
                            </g>
                            
                            <text x="905" y="430" text-anchor="middle" class="component-label">AC Loads</text>
                        </g>

                        <!-- Power Flow Arrows with better positioning -->
                        <defs>
                            <marker id="arrowhead-green" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#059669" />
                            </marker>
                            <marker id="arrowhead-green-start" markerWidth="10" markerHeight="7" refX="1" refY="3.5" orient="auto">
                                <polygon points="10 0, 0 3.5, 10 7" fill="#059669" />
                            </marker>
                            <marker id="arrowhead-blue" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#2563eb" />
                            </marker>
                            <marker id="arrowhead-red" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#dc2626" />
                            </marker>
                        </defs>
                        
                        <!-- Improved power flow lines with proper spacing -->
                        <g class="power-flow-group">
                            <!-- Solar to MPPT -->
                            <line x1="280" y1="130" x2="400" y2="130" stroke="#059669" stroke-width="4" marker-end="url(#arrowhead-green)" class="power-flow"/>
                            <text id="generation-power" x="330" y="120" class="connection-label power-label" text-anchor="middle" font-weight="bold" fill="#059669">863W</text>
                            
                            <!-- MPPT to Battery (Bidirectional) -->
                            <line x1="450" y1="165" x2="450" y2="325" stroke="#059669" stroke-width="4" marker-end="url(#arrowhead-green)" marker-start="url(#arrowhead-green-start)" class="power-flow"/>
                            <text x="465" y="245" class="connection-label power-label" fill="#059669" font-weight="bold">Charging/Discharging</text>
                            
                            <!-- Battery to Inverter with curved path -->
                            <path d="M 500 370 Q 580 370 660 370" stroke="#2563eb" stroke-width="4" fill="none" marker-end="url(#arrowhead-blue)" class="power-flow"/>
                            <text x="580" y="360" class="connection-label power-label" fill="#2563eb" text-anchor="middle" font-weight="bold">48V DC</text>
                            
                            <!-- MPPT to DC Loads -->
                            <line x1="500" y1="130" x2="660" y2="130" stroke="#dc2626" stroke-width="4" marker-end="url(#arrowhead-red)" class="power-flow"/>
                            <text id="dc-load-power" x="710" y="90" class="connection-label power-label" fill="#dc2626" font-weight="bold" text-anchor="middle">DC: 205W</text>
                            
                            <!-- Inverter to AC Loads -->
                            <line x1="760" y1="370" x2="860" y2="370" stroke="#dc2626" stroke-width="4" marker-end="url(#arrowhead-red)" class="power-flow"/>
                            <text id="load-power" x="905" y="315" class="connection-label power-label" fill="#dc2626" text-anchor="middle" font-weight="bold">AC: 1400W</text>
                        </g>
                    </svg>
                </div>

                <div class="diagram-stats">
                    <div class="stat-card">
                        <h4>System Overview</h4>
                        <p>Total Power: <span id="system-power">2000W</span></p>
                        <p>Battery Voltage: <span id="system-voltage">48V</span></p>
                        <p>System Type: Off-Grid Standalone</p>
                    </div>
                </div>
            </section>

            <!-- Section 2: Array Configuration -->
            <section id="array-config-section" class="section">
                <div class="section-header">
                    <h2>Solar Array Configuration</h2>
                    <p>Design your solar array by configuring series and parallel connections</p>
                </div>

                <div class="config-container">
                    <!-- Merged Panel Selection and Array Configuration -->
                    <div class="panel-and-config-merged">
                        <h3>Solar Panel Selection & Array Configuration</h3>

                        <div class="merged-content">
                            <div class="panel-selection-inline">
                                <label for="panel-select">Choose Solar Panel:</label>
                                <select id="panel-select" class="panel-dropdown">
                                    <option value="0">SunPower SPR-350-WHT (350W)</option>
                                    <option value="1">LG NeON R LG365Q1C-A5 (365W)</option>
                                    <option value="2">Canadian Solar CS3U-400MS (400W)</option>
                                    <option value="3">Jinko Tiger Pro JKM450M-60HL4-V (450W)</option>
                                    <option value="4">REC Alpha Pure-R REC405AA (405W)</option>
                                </select>
                            </div>

                            <div class="config-inputs-inline">
                                <div class="input-group">
                                    <label for="series-modules">Modules in Series:</label>
                                    <input type="number" id="series-modules" min="1" max="20" value="2">
                                </div>
                                <div class="input-group">
                                    <label for="parallel-strings">Parallel Strings:</label>
                                    <input type="number" id="parallel-strings" min="1" max="10" value="3">
                                </div>
                                <div class="input-group">
                                    <label for="cell-temperature">Cell Temperature (°C):</label>
                                    <input type="number" id="cell-temperature" min="-20" max="80" value="25">
                                    <button class="help-btn" data-help="temperature">?</button>
                                </div>
                                <div class="input-group total-modules-display">
                                    <label>Total Modules:</label>
                                    <span id="total-modules-config">6</span>
                                </div>
                            </div>
                        </div>

                        <div class="visual-array">
                            <h4>Visual Array Layout</h4>
                            <div id="array-visual" class="array-visual"></div>
                        </div>
                    </div>

                    <!-- Module Specifications -->
                    <div class="module-specs">
                        <h3>Selected Module Specifications</h3>
                        <div class="spec-grid">
                            <div class="spec-item">
                                <label>Model:</label>
                                <span>SunPower SPR-350-WHT</span>
                            </div>
                            <div class="spec-item">
                                <label>Max Power (Pmax):</label>
                                <span>350W</span>
                            </div>
                            <div class="spec-item">
                                <label>Voltage at Pmax (Vmp):</label>
                                <span>29.8V</span>
                            </div>
                            <div class="spec-item">
                                <label>Current at Pmax (Imp):</label>
                                <span>11.75A</span>
                            </div>
                            <div class="spec-item">
                                <label>Open Circuit Voltage (Voc):</label>
                                <span>36.3V</span>
                            </div>
                            <div class="spec-item">
                                <label>Short Circuit Current (Isc):</label>
                                <span>12.47A</span>
                            </div>
                            <div class="spec-item">
                                <label>Temp Coefficient (Power):</label>
                                <span id="temp-coeff-power">-0.29%/°C</span>
                            </div>
                            <div class="spec-item">
                                <label>Temp Coefficient (Voltage):</label>
                                <span id="temp-coeff-voltage">-0.27%/°C</span>
                            </div>
                            <div class="spec-item">
                                <label>Temp Coefficient (Current):</label>
                                <span id="temp-coeff-current">+0.06%/°C</span>
                            </div>
                        </div>
                    </div>

                    <div class="array-results">
                        <!-- Row 1: STC Conditions (Always Visible) -->
                        <div class="array-output-row stc-row">
                            <h3>Array Output (STC Conditions)</h3>
                            <div class="results-grid">
                                <div class="result-item">
                                    <label>Array Power:</label>
                                    <span id="array-power-stc">2100W</span>
                                </div>
                                <div class="result-item">
                                    <label>Array Voltage (Vmp):</label>
                                    <span id="array-voltage-stc">82.6V</span>
                                </div>
                                <div class="result-item">
                                    <label>Array Current (Imp):</label>
                                    <span id="array-current-stc">25.4A</span>
                                </div>
                                <div class="result-item">
                                    <label>Open Circuit Voltage (Voc):</label>
                                    <span id="array-voc-stc">98.4V</span>
                                </div>
                                <div class="result-item">
                                    <label>Short Circuit Current (Isc):</label>
                                    <span id="array-isc-stc">27.2A</span>
                                </div>
                            </div>
                        </div>

                        <!-- Row 2: Derated Conditions (Conditional) -->
                        <div class="array-output-row derated-row" id="derated-row" style="display: none;">
                            <h3>Derated Output at <span id="derated-temp">26</span>°C</h3>
                            <div class="results-grid">
                                <div class="result-item">
                                    <label>Derated Power:</label>
                                    <span id="array-power-derated">2100W</span>
                                </div>
                                <div class="result-item">
                                    <label>Derated Voltage (Vmp):</label>
                                    <span id="array-voltage-derated">82.6V</span>
                                </div>
                                <div class="result-item">
                                    <label>Derated Current (Imp):</label>
                                    <span id="array-current-derated">25.4A</span>
                                </div>
                                <div class="result-item">
                                    <label>Derated Voc:</label>
                                    <span id="array-voc-derated">98.4V</span>
                                </div>
                                <div class="result-item">
                                    <label>Derated Isc:</label>
                                    <span id="array-isc-derated">27.2A</span>
                                </div>
                            </div>
                        </div>

                        <button class="proceed-btn" id="proceed-to-mppt">Use This Array for MPPT Selection</button>
                    </div>
                </div>
            </section>

            <!-- Section 3: Solar Site Analysis -->
            <section id="site-analysis-section" class="section">
                <div class="section-header">
                    <h2>Solar Site Analysis</h2>
                    <p>Optimize your system performance by analyzing location and installation parameters</p>
                </div>

                <div class="site-container">
                    <div class="location-panel">
                        <h3>Location Selection</h3>
                        <div class="location-selector">
                            <label for="location-select">Choose Location:</label>
                            <select id="location-select" class="location-dropdown">
                                <optgroup label="United States">
                                    <option value="phoenix">Phoenix, AZ</option>
                                    <option value="los_angeles">Los Angeles, CA</option>
                                    <option value="miami">Miami, FL</option>
                                    <option value="denver">Denver, CO</option>
                                    <option value="houston">Houston, TX</option>
                                    <option value="new_york">New York, NY</option>
                                    <option value="chicago">Chicago, IL</option>
                                    <option value="seattle">Seattle, WA</option>
                                </optgroup>
                                <optgroup label="Australia">
                                    <option value="sydney">Sydney, NSW</option>
                                    <option value="melbourne">Melbourne, VIC</option>
                                    <option value="brisbane">Brisbane, QLD</option>
                                    <option value="perth">Perth, WA</option>
                                    <option value="adelaide">Adelaide, SA</option>
                                    <option value="canberra">Canberra, ACT</option>
                                </optgroup>
                            </select>
                        </div>
                        
                        <div class="location-info">
                            <h4>Selected Location:</h4>
                            <p id="location-display">Phoenix, AZ</p>
                            <p><strong>Latitude:</strong> <span id="latitude-display">33.4°N</span></p>
                            <p><strong>Longitude:</strong> <span id="longitude-display">112.1°W</span></p>
                            <p><strong>POA Irradiance:</strong> <span id="ghi-display">2200 kWh/m²/year</span></p>
                            <p style="font-size: 0.85rem; color: #6b7280; margin-top: 0.5rem;"><em>Data Source: NASA POWER (2024)</em></p>
                        </div>
                    </div>

                    <div class="angle-panel">
                        <h3>Installation Angles</h3>
                        
                        <div class="angle-control">
                            <label for="tilt-angle">Tilt Angle:</label>
                            <input type="range" id="tilt-angle" min="0" max="90" value="33" class="angle-slider">
                            <span id="tilt-display">33°</span>
                            <div id="optimal-tilt-display" class="optimal-indicator">Optimal: 33°</div>
                            <div class="angle-explanation">
                                <p><small><strong>Tilt Angle Guide:</strong> Optimal angle typically equals latitude ±15°. Steeper angles favor winter generation, flatter angles favor summer output.</small></p>
                                <p><small><strong>Seasonal optimization:</strong> Latitude-15° for summer focus, Latitude+15° for winter focus, or adjustable mounting for year-round optimization.</small></p>
                            </div>
                        </div>
                        
                        <div class="angle-control">
                            <label for="azimuth-angle">Azimuth Angle:</label>
                            <input type="range" id="azimuth-angle" min="0" max="360" value="180" class="angle-slider">
                            <span id="azimuth-display">180°</span>
                            <div class="azimuth-compass">
                                <div class="compass-directions">
                                    <span class="north">N (0°)</span>
                                    <span class="east">E (90°)</span>
                                    <span class="south" id="south-direction">S (180°)</span>
                                    <span class="west">W (270°)</span>
                                </div>
                                <div id="hemisphere-note" class="hemisphere-note">
                                    <em>North-facing optimal in Southern Hemisphere</em>
                                </div>
                            </div>
                            <div class="angle-explanation">
                                <p><small><strong>Azimuth Angle Guide:</strong> 180° (South-facing) optimal in Northern Hemisphere for maximum sun exposure. In Southern Hemisphere, 0° (North-facing) is optimal as the sun travels through the northern sky.</small></p>
                                <p><small><strong>Why it matters:</strong> Proper azimuth orientation can increase energy generation by 10-25% compared to east/west orientations.</small></p>
                            </div>
                        </div>
                    </div>

                    <div class="performance-impact">
                        <h3>Performance Impact</h3>

                        <div class="impact-grid">
                            <div class="impact-item">
                                <label>Estimated Annual Generation:</label>
                                <span id="annual-generation">Calculate</span>
                            </div>
                            <div class="impact-item">
                                <label>Performance Ratio (PR):</label>
                                <span id="performance-ratio">Calculate</span>
                            </div>
                            <div class="impact-item">
                                <label>Specific Yield:</label>
                                <span id="irradiation-factor">Calculate</span>
                            </div>
                        </div>

                        <div class="site-recommendations">
                            <h4>Recommendations</h4>
                            <ul id="site-recommendations-list">
                                <li>Tilt angle is optimal for this location</li>
                                <li>South-facing orientation maximizes generation</li>
                                <li>Consider seasonal tilt adjustments</li>
                            </ul>
                        </div>

                        <div class="pr-details">
                            <div class="pr-formula-compact">
                                <strong>PR Formula:</strong> Inverter × Temperature × Soiling × Wiring × Mismatch
                            </div>

                            <div class="loss-breakdown-compact">
                                <div class="loss-row">
                                    <span>Inverter:</span>
                                    <span id="inverter-efficiency">96.0%</span>
                                </div>
                                <div class="loss-row">
                                    <span>Temperature:</span>
                                    <span id="temperature-loss">90.0%</span>
                                </div>
                                <div class="loss-row">
                                    <span>Soiling:</span>
                                    <span id="soiling-loss">98.0%</span>
                                </div>
                                <div class="loss-row">
                                    <span>Wiring:</span>
                                    <span id="wiring-loss">98.0%</span>
                                </div>
                                <div class="loss-row">
                                    <span>Mismatch:</span>
                                    <span id="mismatch-loss">98.0%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section 4: MPPT Selection -->
            <section id="mppt-selection-section" class="section">
                <div class="section-header">
                    <h2>MPPT Charge Controller Selection</h2>
                    <p>Select the appropriate MPPT controller for your configured PV array</p>
                </div>

                <div class="mppt-container">
                    <div class="array-summary" id="array-summary">
                        <h3 id="array-summary-title">Your PV Array Specifications</h3>
                        <div class="summary-grid">
                            <div class="summary-item">
                                <label>Total Power:</label>
                                <span id="summary-power">2100W</span>
                            </div>
                            <div class="summary-item">
                                <label>Operating Voltage (Vmp):</label>
                                <span id="summary-voltage">82.6V</span>
                            </div>
                            <div class="summary-item">
                                <label>Operating Current (Imp):</label>
                                <span id="summary-current">25.44A</span>
                            </div>
                            <div class="summary-item">
                                <label>Open Circuit Voltage (Voc):</label>
                                <span id="summary-voc">98.4V</span>
                            </div>
                            <div class="summary-item">
                                <label>Short Circuit Current (Isc):</label>
                                <span id="summary-isc">27.21A</span>
                            </div>
                        </div>
                    </div>

                    <div class="mppt-options">
                        <h3>Available MPPT Controllers</h3>
                        <div class="controller-grid">
                            <!-- Controller cards will be dynamically generated by JavaScript -->
                        </div>
                    </div>

                    <div class="selection-feedback" id="selection-feedback" style="display: none;">
                        <!-- Feedback will be dynamically populated -->
                    </div>

                    <div class="hints-panel">
                        <button class="hint-btn" id="show-hints">Show Sizing Hints</button>
                        <div class="hints-content" id="hints-content" style="display: none;">
                            <h4>MPPT Controller Sizing Guidelines:</h4>
                            <div class="hints-visual">
                                <img src="img/PV system component matching animation0.png" alt="MPPT Sizing Guide" class="hints-image">
                            </div>
                            <ul>
                                <li><strong>Voltage Rating:</strong> Controller max voltage > PV array Voc (with safety margin)</li>
                                <li><strong>Current Rating:</strong> Controller max current ≥ PV array Isc × 1.25</li>
                                <li><strong>Power Rating:</strong> Consider battery voltage for power calculation</li>
                                <li><strong>MPPT Range:</strong> Should include PV array's Vm operating voltage</li>
                                <li><strong>Safety Factor:</strong> Always include 25% safety margin for current</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section 5: AC System/Inverter Selection -->
            <section id="inverter-selection-section" class="section">
                <div class="section-header">
                    <h2>AC System & Inverter Selection</h2>
                    <p>Complete your system with appropriate inverter selection</p>
                </div>

                <div class="inverter-container">
                    <div class="load-analysis">
                        <h3>AC Load Requirements</h3>
                        <div class="load-table">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Load Type</th>
                                        <th>Power (W)</th>
                                        <th>Hours/Day</th>
                                        <th>Daily Energy (Wh)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>LED Lighting</td>
                                        <td>200</td>
                                        <td>6</td>
                                        <td>1200</td>
                                    </tr>
                                    <tr>
                                        <td>Refrigerator</td>
                                        <td>150</td>
                                        <td>8</td>
                                        <td>1200</td>
                                    </tr>
                                    <tr>
                                        <td>TV & Electronics</td>
                                        <td>300</td>
                                        <td>4</td>
                                        <td>1200</td>
                                    </tr>
                                    <tr>
                                        <td>Water Pump</td>
                                        <td>750</td>
                                        <td>1</td>
                                        <td>750</td>
                                    </tr>
                                    <tr class="total-row">
                                        <td><strong>Total</strong></td>
                                        <td><strong>1400W</strong></td>
                                        <td><strong>-</strong></td>
                                        <td><strong>4350Wh</strong></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="dc-load-analysis">
                        <h3>DC Load Requirements</h3>
                        <div class="dc-load-table">
                            <table>
                                <thead>
                                    <tr>
                                        <th>DC Load Type</th>
                                        <th>Power (W)</th>
                                        <th>Hours/Day</th>
                                        <th>Daily Energy (Wh)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>LED Lights</td>
                                        <td>50</td>
                                        <td>8</td>
                                        <td>400</td>
                                    </tr>
                                    <tr>
                                        <td>DC Fans</td>
                                        <td>25</td>
                                        <td>10</td>
                                        <td>250</td>
                                    </tr>
                                    <tr>
                                        <td>DC Refrigerator</td>
                                        <td>100</td>
                                        <td>12</td>
                                        <td>1200</td>
                                    </tr>
                                    <tr>
                                        <td>Electronics</td>
                                        <td>30</td>
                                        <td>16</td>
                                        <td>480</td>
                                    </tr>
                                    <tr class="total-row">
                                        <td><strong>Total DC</strong></td>
                                        <td><strong>205W</strong></td>
                                        <td><strong>-</strong></td>
                                        <td><strong>2330Wh</strong></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="inverter-options">
                        <h3>Available Inverters</h3>
                        <div class="inverter-grid">
                            <!-- Inverter cards will be dynamically generated by JavaScript -->
                        </div>
                    </div>

                    <div class="inverter-feedback" id="inverter-feedback" style="display: none;">
                        <!-- Feedback will be dynamically populated -->
                    </div>

                    <div class="hints-panel">
                        <button class="hint-btn" id="show-inverter-hints">Show Inverter Sizing Hints</button>
                        <div class="hints-content" id="inverter-hints-content" style="display: none;">
                            <h4>Inverter Sizing Guidelines:</h4>
                            <div class="hints-visual">
                                <img src="img/PV system component matching animation1.png" alt="Inverter Sizing Guide" class="hints-image">
                            </div>
                            <ul>
                                <li><strong>Max AC Output:</strong> Should be ≥ Total AC load power for continuous operation</li>
                                <li><strong>Surge Power:</strong> Must handle motor starting currents (typically 3-5x running power)</li>
                                <li><strong>Input Voltage:</strong> Must match battery bank voltage (12V, 24V, 48V)</li>
                                <li><strong>Efficiency:</strong> Higher efficiency reduces energy losses and heat</li>
                                <li><strong>Load Analysis:</strong> Consider simultaneous loads vs. total connected loads</li>
                                <li><strong>Future Expansion:</strong> Size for anticipated load growth (20-30% margin)</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section 6: System Simulation -->
            <section id="simulation-section" class="section">
                <div class="section-header">
                    <h2>System Simulation</h2>
                    <p>Analyze 24-hour system performance with interactive visualization</p>
                </div>

                <div class="simulation-container">
                    <div class="simulation-controls">
                        <h3>Simulation Parameters</h3>
                        <div class="control-grid">
                            <div class="control-item">
                                <label>System Configuration:</label>
                                <span id="sim-system-config">Based on your selections</span>
                            </div>
                            <div class="control-item">
                                <label>Location:</label>
                                <span id="sim-location">Phoenix, AZ</span>
                            </div>
                            <div class="control-item">
                                <label>Weather Conditions:</label>
                                <select id="weather-condition">
                                    <option value="clear">Clear Sky (100% potential)</option>
                                    <option value="partly_cloudy">Partly Cloudy (70-85% potential)</option>
                                    <option value="overcast">Overcast (30% potential)</option>
                                </select>
                            </div>
                            <div class="control-item">
                                <label>Season:</label>
                                <select id="season-select">
                                    <option value="summer">Summer</option>
                                    <option value="spring">Spring/Fall</option>
                                    <option value="winter">Winter</option>
                                </select>
                            </div>
                        </div>
                        
                        <button id="simulate-btn" class="simulate-button">Start 24-Hour Simulation</button>
                    </div>

                    <div id="simulation-results" class="simulation-results" style="display: none;">
                        <h3>24-Hour System Performance</h3>
                        
                        <div class="chart-container">
                            <canvas id="simulation-chart" width="800" height="400"></canvas>
                        </div>
                        
                        <div class="simulation-summary">
                            <h4>Daily Summary</h4>
                            <div class="summary-stats">
                                <div class="stat-box">
                                    <span class="stat-value" id="daily-generation">0</span>
                                    <span class="stat-label">kWh Generated</span>
                                </div>
                                <div class="stat-box">
                                    <span class="stat-value" id="daily-consumption">0</span>
                                    <span class="stat-label">kWh Consumed</span>
                                </div>
                                <div class="stat-box">
                                    <span class="stat-value" id="net-energy">0</span>
                                    <span class="stat-label">kWh Net Energy</span>
                                </div>
                                <div class="stat-box">
                                    <span class="stat-value" id="battery-cycles">0</span>
                                    <span class="stat-label">Battery Cycles</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="performance-insights">
                            <h4>Performance Insights</h4>
                            <ul id="insights-list">
                                <li>System analysis will appear after simulation</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Modal for Component Information -->
    <div id="component-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="modal-title">Component Information</h2>
            <div id="modal-body">
                <!-- Content will be dynamically populated -->
            </div>
        </div>
    </div>

    <!-- Modal for Help/Educational Content -->
    <div id="help-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="help-title">Educational Content</h2>
            <div id="help-body">
                <!-- Content will be dynamically populated -->
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>